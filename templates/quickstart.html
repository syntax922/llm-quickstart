<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LM Studio Gateway Quickstart</title>
  <link rel="stylesheet" href="/quickstart/static/style.css" />
</head>
<body>
  <div class="page">
    <header class="hero">
      <div>
        <p class="eyebrow">LM Studio Gateway</p>
        <h1>Quickstart</h1>
        <p class="subtitle">
          Authenticate with OAuth2, configure VS Code Copilot Chat, and start calling the LM Studio REST API in minutes.
        </p>
      </div>
      <a class="docs-link" href="https://lmstudio.ai/docs/developer/rest" target="_blank" rel="noreferrer">
        More docs →
      </a>
    </header>

    <div class="layout">
      <nav class="toc">
        <p class="toc-title">On this page</p>
        <a href="#overview">Overview</a>
        <a href="#cookie">Get your cookie</a>
        <a href="#cli-vars">CLI variables</a>
        <a href="#models">List models</a>
        <a href="#chat">Non-stream chat</a>
        <a href="#stream">Streaming chat (SSE)</a>
        <a href="#openai">OpenAI SDK (Python)</a>
        <a href="#bearer">Bearer token auth</a>
        <a href="#vscode-copilot">VS Code Copilot Chat</a>
        <a href="#troubleshooting">Troubleshooting</a>
        <a href="#signout">Sign out</a>
      </nav>

      <main class="content">
        <section class="card" id="overview">
      <h2>Overview</h2>
      <p>
        This gateway is protected by OAuth. You must be on the allowlist to access the API. The session cookie grants
        access to the gateway — treat it like a password and never share it publicly.
      </p>
      <div class="callout warning">
        <strong>Security:</strong> The session cookie enables access to your account. Store it securely and rotate if
        you suspect exposure.
      </div>
        </section>

        <section class="card" id="cookie">
      <h2>Get your cookie</h2>
      {{if .CookiePresent}}
      <p>
        Your <code>{{.CookieName}}</code> cookie was detected. Keep it secret and use the copy buttons below to paste
        into a cookies.txt file or your curl commands.
      </p>
      <div class="cookie-panel">
        <label for="cookie-value">Session cookie</label>
        <div class="cookie-controls">
          <input id="cookie-value" type="password" value="{{.CookieValue}}" readonly />
          <button class="secondary" data-action="reveal" data-target="cookie-value">Reveal</button>
          <button class="primary" data-action="copy-input" data-target="cookie-value">Copy</button>
        </div>
      </div>
      <div class="code-grid">
        <div>
          <div class="code-header">
            <span>Netscape cookie jar (cookies.txt)</span>
            <button class="copy-button" data-copy-target="cookie-jar">Copy</button>
          </div>
            <pre class="code-block wrap"><code id="cookie-jar">{{.CookieJarSnippet}}</code></pre>
        </div>
      </div>
      {{else}}
      <div class="callout danger">
        <strong>No cookie detected.</strong> Visit <code>{{.BaseURL}}/oauth2/sign_in</code> to authenticate, then
        reload this page.
      </div>
      {{end}}
        </section>

        <section class="card" id="cli-vars">
      <h2>Set up your CLI variables</h2>
      <p>
        Define a base URL, the cookie file location, and a model ID from the <code>/v1/models</code> response.
      </p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="cli-vars">Copy</button>
      </div>
      <pre class="code-block"><code id="cli-vars">export BASE_URL="{{.BaseURL}}"
export COOKIE_FILE="cookies.txt"
export MODEL_ID="&lt;MODEL_ID_FROM_V1_MODELS&gt;"</code></pre>
      <p class="hint">Replace <code>&lt;MODEL_ID_FROM_V1_MODELS&gt;</code> with the first model ID returned by <code>/v1/models</code>.</p>
        </section>

        <section class="card" id="models">
      <h2>Test: list models</h2>
      <p>Save the cookie jar snippet above to <code>cookies.txt</code>, then call the models endpoint.</p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="models-curl">Copy</button>
      </div>
      <pre class="code-block"><code id="models-curl">curl -b "$COOKIE_FILE" "$BASE_URL/v1/models"</code></pre>
      <div class="code-header">
        <span>sample output</span>
        <button class="copy-button" data-copy-target="models-output">Copy</button>
      </div>
      <pre class="code-block"><code id="models-output">{
  "data": [
    {
      "id": "lmstudio-community/llama-3.1-8b-instruct",
      "object": "model"
    }
  ],
  "object": "list"
}</code></pre>
        </section>

        <section class="card" id="chat">
      <h2>Test: non-stream chat completion</h2>
      <p>Send a standard chat completion request with streaming disabled.</p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="chat-nonstream">Copy</button>
      </div>
      <pre class="code-block"><code id="chat-nonstream">curl -b "$COOKIE_FILE" \
  -H "Content-Type: application/json" \
  -d "{\"model\":\"$MODEL_ID\",\"stream\":false,\"messages\":[{\"role\":\"user\",\"content\":\"Hello from quickstart\"}]}" \
  "$BASE_URL/v1/chat/completions"</code></pre>
      <div class="code-header">
        <span>sample response</span>
        <button class="copy-button" data-copy-target="chat-nonstream-output">Copy</button>
      </div>
      <pre class="code-block"><code id="chat-nonstream-output">{
  "id": "chatcmpl-...",
  "object": "chat.completion",
  "choices": [
    {
      "index": 0,
      "message": {"role": "assistant", "content": "Hello!"},
      "finish_reason": "stop"
    }
  ]
}</code></pre>
        </section>

        <section class="card" id="stream">
      <h2>Test: streaming chat completion (SSE)</h2>
      <p>Stream tokens in real time using Server-Sent Events.</p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="chat-stream">Copy</button>
      </div>
      <pre class="code-block"><code id="chat-stream">curl -N -b "$COOKIE_FILE" \
  -H "Content-Type: application/json" \
  -d "{\"model\":\"$MODEL_ID\",\"stream\":true,\"messages\":[{\"role\":\"user\",\"content\":\"Hello from streaming\"}]}" \
  "$BASE_URL/v1/chat/completions"</code></pre>
      <p class="hint">Tip: you should see tokens arrive quickly after the request starts.</p>
        </section>

        <section class="card" id="openai">
      <h2>Use with the OpenAI SDK (Python)</h2>
      <div class="code-header">
        <span>python</span>
        <button class="copy-button" data-copy-target="openai-python">Copy</button>
      </div>
      <pre class="code-block"><code id="openai-python">from openai import OpenAI

client = OpenAI(base_url="{{.BaseURL}}/v1", api_key="unused")

response = client.chat.completions.create(
    model="&lt;MODEL_ID&gt;",
    messages=[{"role": "user", "content": "Hello from Python"}],
)
print(response.choices[0].message.content)</code></pre>
        </section>

        <section class="card" id="bearer">
      <h2>Use a Google identity token (Bearer)</h2>
      <p>
        OAuth2-proxy can accept a Google identity token. Use the same audience as the OAuth client ID and pass the
        token as a Bearer header.
      </p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="gcloud-login">Copy</button>
      </div>
      <pre class="code-block"><code id="gcloud-login">gcloud auth login

gcloud auth print-identity-token \
  --audiences="{{.OauthAudience}}" \
  --include-email</code></pre>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="gcloud-bearer">Copy</button>
      </div>
      <pre class="code-block"><code id="gcloud-bearer">TOKEN=$(gcloud auth print-identity-token --audiences="{{.OauthAudience}}")

curl -H "Authorization: Bearer $TOKEN" \
  "$BASE_URL/v1/models"</code></pre>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="gcloud-stream">Copy</button>
      </div>
      <pre class="code-block"><code id="gcloud-stream">TOKEN=$(gcloud auth print-identity-token --audiences="{{.OauthAudience}}")

curl -N -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"model\":\"$MODEL_ID\",\"stream\":true,\"messages\":[{\"role\":\"user\",\"content\":\"Hello\"}]}" \
  "$BASE_URL/v1/chat/completions"</code></pre>
        </section>

        <section class="card" id="vscode-copilot">
      <h2>VS Code Copilot Chat Configuration</h2>
      <p>
        To use VS Code Copilot Chat with this gateway, you need an OAuth2 access token obtained via the
        <code>client_credentials</code> grant. This is different from a simple API key.
      </p>
      
      <h3>Step 1: Get Your Authentik Credentials</h3>
      <ol>
        <li>Log in to Authentik at <a href="https://auth.rebelscum.network">auth.rebelscum.network</a></li>
        <li>Navigate to <strong>User Settings</strong> → <strong>Tokens &amp; App Passwords</strong></li>
        <li>Create a new <strong>App Password</strong> (NOT an API token):
          <ul>
            <li>Intent: <strong>App Password</strong></li>
            <li>Expiration: Choose appropriate duration (or leave blank for non-expiring)</li>
          </ul>
        </li>
      </ol>

      <h3>Step 2: Exchange for OAuth2 Access Token</h3>
      <p>Use the following command to exchange your App Password for an OAuth2 access token:</p>
      <div class="code-header">
        <span>bash</span>
        <button class="copy-button" data-copy-target="vscode-token">Copy</button>
      </div>
      <pre class="code-block"><code id="vscode-token">curl -s -X POST \
  --data-urlencode "grant_type=client_credentials" \
  --data-urlencode "client_id=xvhEjbgXSEAYiHdXdRvBGUPVpyDUlXnaRdwZH10g" \
  --data-urlencode "username=&lt;your-authentik-username&gt;" \
  --data-urlencode "password=&lt;your-app-password&gt;" \
  https://auth.rebelscum.network/application/o/token/ | python3 -m json.tool</code></pre>
      <p>Replace <code>&lt;your-authentik-username&gt;</code> with your Authentik username and <code>&lt;your-app-password&gt;</code> with the App Password from Step 1.</p>
      <div class="callout note">
        <strong>Note:</strong> The response will include an <code>access_token</code> that you'll use in VS Code.</div>

      <h3>Step 3: Configure VS Code</h3>
      <ol>
        <li>Open VS Code (Insiders recommended)</li>
        <li>Go to <strong>File</strong> → <strong>Preferences</strong> → <strong>Settings</strong></li>
        <li>Click the <code>{}</code> icon in the top-right to open <code>settings.json</code></li>
        <li>Add the following configuration:</li>
      </ol>
      <div class="code-header">
        <span>json</span>
        <button class="copy-button" data-copy-target="vscode-settings">Copy</button>
      </div>
      <pre class="code-block"><code id="vscode-settings">{
  "github.copilot.languageModels": {
    "lm-studio-ig88": {
      "url": "https://ai.rebelscum.network/v1",
      "apiKey": "&lt;access_token-from-step-2&gt;"
    }
  }
}</code></pre>
      <p>Replace <code>&lt;access_token-from-step-2&gt;</code> with the <code>access_token</code> value from Step 2.</p>

      <h3>Troubleshooting</h3>
      <ul class="troubleshooting-list">
        <li><strong>401/403 error:</strong> Ensure you're using the OAuth2 <code>access_token</code>, NOT an Authentik API token.</li>
        <li><strong>"No models loaded":</strong> Check that your token has <code>ak_proxy</code> scope and you're on the allowlist.</li>
        <li><strong>Token expired:</strong> Re-run the curl command from Step 2 to refresh your token.</li>
      </ul>
        </section>

        <section class="card" id="troubleshooting">
      <h2>Troubleshooting</h2>
      <ul>
        <li><strong>401/403:</strong> Your account is not on the allowlist or your cookie has expired. Re-authenticate.</li>
        <li><strong>302 redirect:</strong> You are not logged in. Refresh the page to trigger the OAuth flow.</li>
        <li><strong>Model not found:</strong> Run <code>/v1/models</code> and paste a valid model ID.</li>
        <li><strong>Streaming stalls:</strong> Verify <code>stream=true</code> and that your client supports SSE.</li>
      </ul>
        </section>

        <section class="card" id="signout">
      <h2>Sign out</h2>
      <p>
        Signing out revokes the <code>{{.CookieName}}</code> session cookie stored in your browser. Use this if you
        shared a machine or want to invalidate your current session.
      </p>
      <a class="button-link" href="/signout">Sign out of the gateway</a>
      <p class="hint">You will be redirected back to the sign-in flow if you visit the page again.</p>
        </section>
      </main>
    </div>

    <footer class="footer">
      <span>Need more?</span>
      <a href="https://lmstudio.ai/docs/developer/rest" target="_blank" rel="noreferrer">
        LM Studio REST docs
      </a>
    </footer>
  </div>
  <script src="/quickstart/static/app.js"></script>
</body>
</html>
